<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-contribution/tools/flamegraphs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.0">
<title data-rh="true">Lodestar Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://chainsafe.github.io/lodestar/contribution/tools/flamegraphs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Flame Graphs | Lodestar"><meta data-rh="true" name="description" content="This guide assumes a running instance of Lodestar and will walk through how to generate a flamegraph for the process while running on Linux. While it is possible to run Lodestar in a number of ways, for performance profiling it is recommended to not use Dockerized implementations. It is best to run Lodestar as a service on a Linux machine. Follow the Lodestar docs to get the service installed and running. Then come back here when you are ready to generate the flamegraph."><meta data-rh="true" property="og:description" content="This guide assumes a running instance of Lodestar and will walk through how to generate a flamegraph for the process while running on Linux. While it is possible to run Lodestar in a number of ways, for performance profiling it is recommended to not use Dockerized implementations. It is best to run Lodestar as a service on a Linux machine. Follow the Lodestar docs to get the service installed and running. Then come back here when you are ready to generate the flamegraph."><link data-rh="true" rel="icon" href="/lodestar/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://chainsafe.github.io/lodestar/contribution/tools/flamegraphs"><link data-rh="true" rel="alternate" href="https://chainsafe.github.io/lodestar/contribution/tools/flamegraphs" hreflang="en"><link data-rh="true" rel="alternate" href="https://chainsafe.github.io/lodestar/contribution/tools/flamegraphs" hreflang="x-default"><script src="https://plausible.io/js/script.js" defer="defer" data-domain="chainsafe.github.io/lodestar"></script><link rel="stylesheet" href="/lodestar/assets/css/styles.79b491cb.css">
<script src="/lodestar/assets/js/runtime~main.ac65c388.js" defer="defer"></script>
<script src="/lodestar/assets/js/main.e2ca73f1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lodestar/"><div class="navbar__logo"><img src="/lodestar/images/logo.png" alt="Lodestar Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/lodestar/images/logo.png" alt="Lodestar Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Lodestar Documentation</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ChainSafe/lodestar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lodestar/">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lodestar/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lodestar/security">Security Policy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/lodestar/run/getting-started/installation">Run A Node</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/run/getting-started/installation">Install Options</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/run/getting-started/quick-start">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/run/beacon-management/starting-a-node">Beacon Node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/run/validator-management/vc-configuration">Validator Client</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/run/logging-and-metrics/prometheus-grafana">Logging and Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/run/bootnode/bootnode-cli">Discv5 Bootnode</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/lodestar/libraries/lightclient-prover/lightclient">Developer Tools</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/libraries/lightclient-prover/lightclient">Light Client</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/libraries/lightclient-prover/prover">Prover</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lodestar/supporting-libraries/">Supporting Libraries</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/lodestar/contribution/getting-started">Contributing</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/contribution/advanced-topics/setting-up-a-testnet">Advanced Topics</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/depgraph">Dependency Graph</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/lodestar/contribution/dev-cli">Development Tools</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/dev-cli">CLI Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/tools/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lodestar/contribution/tools/flamegraphs">Flame Graphs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/tools/heap-dumps">Heap Dumps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/lodestar/contribution/tools/core-dumps">Core Dumps</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/lodestar/contribution/testing/">Testing</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lodestar/faqs">Frequently Asked Questions</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/lodestar/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Contributing</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development Tools</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Flame Graphs</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Generating Flamegraphs for a Running Node Service on Linux</h1>
<p>This guide assumes a running instance of Lodestar and will walk through how to generate a flamegraph for the process while running on Linux. While it is possible to run Lodestar in a number of ways, for performance profiling it is recommended to not use Dockerized implementations. It is best to run Lodestar as a service on a Linux machine. Follow the Lodestar docs to get the service installed and running. Then come back here when you are ready to generate the flamegraph.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-linux-and-lodestar">Modifying Linux and Lodestar<a href="#modifying-linux-and-lodestar" class="hash-link" aria-label="Direct link to Modifying Linux and Lodestar" title="Direct link to Modifying Linux and Lodestar">​</a></h2>
<p>Use the following two commands to install <code>perf</code> for generating the stack traces. You may get a warning about needing to restart the VM due to kernel updates. This is nothing to be concerned with and if so, cancel out of the restart dialog.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> linux-tools-common linux-tools-generic</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> linux-tools-</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token variable function" style="color:rgb(0, 0, 255)">uname</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token variable" style="color:rgb(9, 134, 88)">`</span><span class="token plain">  </span><span class="token comment" style="color:rgb(0, 128, 0)"># empirically this throws if run on the same line above</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Next we need to update the Lodestar service by modifying the start script. We need to add a necessary flag <code>--perf-basic-prof</code> to allow the stack traces to be useful. Node is a virtual machine and <code>perf</code> is designed to capture host stack traces. In order to allow the JavaScript functions to be captured meaningfully, <code>v8</code> can provide some help. Generally Lodestar is started with a script like the following:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-start_lodestarsh">Example start_lodestar.sh<a href="#example-start_lodestarsh" class="hash-link" aria-label="Direct link to Example start_lodestar.sh" title="Direct link to Example start_lodestar.sh">​</a></h3>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">node</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --perf-basic-prof </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  --max-old-space-size</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">8192</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  /usr/src/lodestar/packages/cli/bin/lodestar </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  beacon </span><span class="token punctuation" style="color:rgb(4, 81, 165)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">--rcConfig</span><span class="token plain"> /home/devops/beacon/rcconfig.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>After updating the start script, restart the node process running the beacon service. Note in the command below, that the <code>beacon</code> service may have a different name or restart command, depending on your setup.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">admin@12.34.56.78: </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> systemctl restart beacon</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The flag that was added notifies <code>V8</code> to output a map of functions and their addresses. This is necessary for <code>perf</code> to generate the stack traces for the virtual machine in addition to the traditional host stack traces. There is a very small, performance overhead to output the maps. After a short while, once the process runs for a bit the functions will no longer be moving in memory and the overhead will be significantly reduced. The VM will still be moving objects around but this flag is generally safe to run in production. After a few minutes of running, listing the directory with the start script (<code>process.cwd()</code>) will look similar:</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin   </span><span class="token number" style="color:rgb(9, 134, 88)">9701529</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 beacon-2023-05-22.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rwxrwxr-x  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin root        </span><span class="token number" style="color:rgb(9, 134, 88)">421</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:31 beacon_run.sh</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">drwxr-xr-x  </span><span class="token number" style="color:rgb(9, 134, 88)">2</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">917504</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:35 chain-db</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin   </span><span class="token number" style="color:rgb(9, 134, 88)">2861242</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x6761520-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">203172</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fa2f0001060-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin     </span><span class="token number" style="color:rgb(9, 134, 88)">68044</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd80001060-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">420809</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd84001060-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">123919</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd88001060-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin     </span><span class="token number" style="color:rgb(9, 134, 88)">94391</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:35 isolate-0x7fcd8c001060-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">183831</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd90000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">152786</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd94000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">262333</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd98000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">218473</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcd9c000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">366788</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcda0000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">304917</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcda4000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">586238</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcda8000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">450675</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcdac000e60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin admin    </span><span class="token number" style="color:rgb(9, 134, 88)">768470</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">22</span><span class="token plain"> 00:36 isolate-0x7fcdb8000d60-2085004-v8.log</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">-rw-r--r--  </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"> admin root        </span><span class="token number" style="color:rgb(9, 134, 88)">559</span><span class="token plain"> May </span><span class="token number" style="color:rgb(9, 134, 88)">21</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">14</span><span class="token plain">:17 rcconfig.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>isolate-*-v8.log</code> files are the maps that <code>v8</code> outputs for the <code>perf</code> command to reference. You are now ready to collect the stack traces.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="capturing-stack-traces">Capturing Stack Traces<a href="#capturing-stack-traces" class="hash-link" aria-label="Direct link to Capturing Stack Traces" title="Direct link to Capturing Stack Traces">​</a></h3>
<p>The first command below will run <code>perf</code> for 60 seconds, and then save the output to a file named <code>perf.out</code>. The second one will merge the exported, unknown, tokens with the isolate maps and output full stack traces for the render. Running both <code>perf</code> commands in the folder with the <code>isolate</code> maps will allow the data to be seamlessly spliced. Once the output is saved, update the permissions so the file can be copied to your local machine via <code>scp</code>.</p>
<p>You can modify the frequency of capture by changing <code>-F 99</code> to a different number. Try to stay away from whole numbers as they are more likely to cause interference with periodically scheduled tasks. As an example use <code>99Hz</code> or <code>997Hz</code> instead of <code>100Hz</code> or <code>1000Hz</code>. In testing neither seemed to have an appreciable affect on CPU usage when run for a short period of time.</p>
<p>To change the period of capture adjust the sleep duration (which is in seconds).</p>
<p>The <code>pgrep</code> command is used to find the process id to capture against. Feel free to pass a number to the <code>-p</code> flag if you know the process id, or adjust the file path if the executable is in a different location.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">admin@12.34.56.78: </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> perf record </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-F</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">99</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-p</span><span class="token plain"> </span><span class="token variable" style="color:rgb(9, 134, 88)">$(</span><span class="token variable" style="color:rgb(9, 134, 88)">pgrep </span><span class="token variable parameter variable" style="color:rgb(9, 134, 88)">-f</span><span class="token variable" style="color:rgb(9, 134, 88)"> </span><span class="token variable string" style="color:rgb(163, 21, 21)">&#x27;/usr/src/lodestar/packages/cli/bin/lodestar beacon&#x27;</span><span class="token variable" style="color:rgb(9, 134, 88)">)</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-g</span><span class="token plain"> -- </span><span class="token function" style="color:rgb(0, 0, 255)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">admin@12.34.56.78: </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> perf script </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-f</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">&gt;</span><span class="token plain"> perf.out</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">admin@12.34.56.78: </span><span class="token function" style="color:rgb(0, 0, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">777</span><span class="token plain"> ~/beacon/perf.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And then copy the <code>perf.out</code> file to your local machine to render the flamegraph. Running at <code>99Hz</code> for 180 seconds results in a file size of about 3.5MB and <code>997Hz</code> for 60 seconds is roughly 4.4MB.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">scp</span><span class="token plain"> admin@12.34.56.78:/home/devops/beacon/out.perf /some_temp_dir/perf.out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rendering-a-flamegraph">Rendering a Flamegraph<a href="#rendering-a-flamegraph" class="hash-link" aria-label="Direct link to Rendering a Flamegraph" title="Direct link to Rendering a Flamegraph">​</a></h2>
<p>By far the best tool to render flamegraphs is <a href="https://github.com/Netflix/flamescope" target="_blank" rel="noopener noreferrer"><code>flamescope</code></a> from Netflix. It allows for easy analysis and zooming into specific time periods. It also give a holistic view of how the process is performing over time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation">​</a></h2>
<p>Python3 is required. Clone the repository and install the dependencies:</p>
<p><em>The original is no longer maintained and had a configuration bug. This is a fork that fixes the issue.</em></p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">git</span><span class="token plain"> clone https://github.com/matthewkeil/flamescope</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(38, 127, 153)">cd</span><span class="token plain"> flamescope</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">pip3 </span><span class="token function" style="color:rgb(0, 0, 255)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">yarn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">mv</span><span class="token plain"> /some_temp_dir/perf.out /path/to/flamescope/examples</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token function" style="color:rgb(0, 0, 255)">yarn</span><span class="token plain"> dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then navigate in a browser to <code>http://localhost:8080</code> and begin analyzing the data.</p>
<p><img decoding="async" loading="lazy" alt="flamescope home screen" src="/lodestar/assets/images/home-screen-76ab681eaacd7d06a16f0c31060ff359.png" width="3456" height="2234" class="img_ev3q">
<img decoding="async" loading="lazy" alt="flamescope time series view" src="/lodestar/assets/images/time-series-view-7958a50caf1ae7f01f9bd9a5e72bbda5.png" width="3456" height="2234" class="img_ev3q">
<img decoding="async" loading="lazy" alt="flamescope selecting series" src="/lodestar/assets/images/selecting-series-a9918dbbb866698511cd30ebb8d76b96.png" width="3456" height="2234" class="img_ev3q">
<img decoding="async" loading="lazy" alt="flamescope unfiltered flamegraph" src="/lodestar/assets/images/unfiltered-flamegraph-789b99f44ff3385e681cf5c75b190b78.png" width="3456" height="2234" class="img_ev3q">
<img decoding="async" loading="lazy" alt="flamescope zoom in" src="/lodestar/assets/images/zoom-in-5116849f89d0ac63343389deca1d8c39.png" width="3456" height="2234" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="filtering-results">Filtering Results<a href="#filtering-results" class="hash-link" aria-label="Direct link to Filtering Results" title="Direct link to Filtering Results">​</a></h2>
<p>There can be a lot of &quot;noise&quot; in the stack traces with <code>libc</code>, <code>v8</code> and <code>libuv</code> calls. It is possible to filter the results to make it more useful, but note this will skew the results. Looking at the graph both filtered and unfiltered can be beneficial. The following <code>sed</code> command will remove the noise from the stack traces.</p>
<div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token function" style="color:rgb(0, 0, 255)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-r</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-e</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;/( __libc_start| uv_| LazyCompile | v8::internal::| node::| Builtins_| Builtin:| Stub:| LoadIC:| </span><span class="token string entity" style="color:rgb(163, 21, 21)">\\</span><span class="token string" style="color:rgb(163, 21, 21)">[unknown</span><span class="token string entity" style="color:rgb(163, 21, 21)">\\</span><span class="token string" style="color:rgb(163, 21, 21)">]| LoadPolymorphicIC:)/d&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(9, 134, 88)">-e</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&#x27;s/ LazyCompile:[*~]?/ /&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unfiltered">Unfiltered<a href="#unfiltered" class="hash-link" aria-label="Direct link to Unfiltered" title="Direct link to Unfiltered">​</a></h3>
<p><img decoding="async" loading="lazy" alt="flamescope unfiltered flamegraph" src="/lodestar/assets/images/unfiltered-flamegraph-789b99f44ff3385e681cf5c75b190b78.png" width="3456" height="2234" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="filtered">Filtered<a href="#filtered" class="hash-link" aria-label="Direct link to Filtered" title="Direct link to Filtered">​</a></h3>
<p><img decoding="async" loading="lazy" alt="flamescope filtered flamegraph" src="/lodestar/assets/images/filtered-flamegraph-b1c589adab76173d5a0ec9d7cca940aa.png" width="3456" height="2234" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="list-of-web-references">List of Web References<a href="#list-of-web-references" class="hash-link" aria-label="Direct link to List of Web References" title="Direct link to List of Web References">​</a></h3>
<ul>
<li><a href="https://www.brendangregg.com/flamegraphs.html" target="_blank" rel="noopener noreferrer">https://www.brendangregg.com/flamegraphs.html</a></li>
<li><a href="https://nodejs.org/en/docs/guides/diagnostics-flamegraph" target="_blank" rel="noopener noreferrer">https://nodejs.org/en/docs/guides/diagnostics-flamegraph</a></li>
<li><a href="https://netflixtechblog.com/netflix-flamescope-a57ca19d47bb" target="_blank" rel="noopener noreferrer">https://netflixtechblog.com/netflix-flamescope-a57ca19d47bb</a></li>
<li><a href="https://jaanhio.me/blog/nodejs-flamegraph-analysis/" target="_blank" rel="noopener noreferrer">https://jaanhio.me/blog/nodejs-flamegraph-analysis/</a> (this was a great one about filtering methodology)</li>
<li><a href="https://medium.com/voodoo-engineering/node-js-and-cpu-profiling-on-production-in-real-time-without-downtime-d6e62af173e2" target="_blank" rel="noopener noreferrer">https://medium.com/voodoo-engineering/node-js-and-cpu-profiling-on-production-in-real-time-without-downtime-d6e62af173e2</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visualization-tools">Visualization Tools<a href="#visualization-tools" class="hash-link" aria-label="Direct link to Visualization Tools" title="Direct link to Visualization Tools">​</a></h3>
<ul>
<li><a href="https://github.com/Netflix/flamescope" target="_blank" rel="noopener noreferrer"><code>flamescope</code></a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="collecting-on-linux">Collecting on Linux<a href="#collecting-on-linux" class="hash-link" aria-label="Direct link to Collecting on Linux" title="Direct link to Collecting on Linux">​</a></h3>
<ul>
<li><a href="https://www.brendangregg.com/perf.html" target="_blank" rel="noopener noreferrer">https://www.brendangregg.com/perf.html</a></li>
<li><a href="https://www.brendangregg.com/linuxperf.html" target="_blank" rel="noopener noreferrer">https://www.brendangregg.com/linuxperf.html</a></li>
<li><a href="https://www.brendangregg.com/blog/2014-09-17/node-flame-graphs-on-linux.html" target="_blank" rel="noopener noreferrer">https://www.brendangregg.com/blog/2014-09-17/node-flame-graphs-on-linux.html</a></li>
<li><a href="https://perf.wiki.kernel.org/index.php/Main_Page" target="_blank" rel="noopener noreferrer">https://perf.wiki.kernel.org/index.php/Main_Page</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="collecting-on-macos">Collecting on MacOS<a href="#collecting-on-macos" class="hash-link" aria-label="Direct link to Collecting on MacOS" title="Direct link to Collecting on MacOS">​</a></h3>
<ul>
<li><a href="https://gist.github.com/zeusdeux/aac6f8500917319213c5" target="_blank" rel="noopener noreferrer">https://gist.github.com/zeusdeux/aac6f8500917319213c5</a></li>
<li><a href="https://gist.github.com/loderunner/36724cc9ee8db66db305" target="_blank" rel="noopener noreferrer">https://gist.github.com/loderunner/36724cc9ee8db66db305</a></li>
<li><a href="https://keith.github.io/xcode-man-pages/xctrace.1.html" target="_blank" rel="noopener noreferrer">https://keith.github.io/xcode-man-pages/xctrace.1.html</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/ChainSafe/lodestar/tree/unstable/docs/pages/contribution/tools/flamegraphs.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/lodestar/contribution/tools/debugging"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Debugging</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/lodestar/contribution/tools/heap-dumps"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Heap Dumps</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#modifying-linux-and-lodestar" class="table-of-contents__link toc-highlight">Modifying Linux and Lodestar</a><ul><li><a href="#example-start_lodestarsh" class="table-of-contents__link toc-highlight">Example start_lodestar.sh</a></li><li><a href="#capturing-stack-traces" class="table-of-contents__link toc-highlight">Capturing Stack Traces</a></li></ul></li><li><a href="#rendering-a-flamegraph" class="table-of-contents__link toc-highlight">Rendering a Flamegraph</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a></li><li><a href="#filtering-results" class="table-of-contents__link toc-highlight">Filtering Results</a><ul><li><a href="#unfiltered" class="table-of-contents__link toc-highlight">Unfiltered</a></li><li><a href="#filtered" class="table-of-contents__link toc-highlight">Filtered</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a><ul><li><a href="#list-of-web-references" class="table-of-contents__link toc-highlight">List of Web References</a></li><li><a href="#visualization-tools" class="table-of-contents__link toc-highlight">Visualization Tools</a></li><li><a href="#collecting-on-linux" class="table-of-contents__link toc-highlight">Collecting on Linux</a></li><li><a href="#collecting-on-macos" class="table-of-contents__link toc-highlight">Collecting on MacOS</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://lodestar.chainsafe.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Lodestar Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://discord.com/invite/yjyvFRP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://x.com/lodestar_eth" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter/X<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://github.com/ChainSafe/lodestar" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 ChainSafe. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>